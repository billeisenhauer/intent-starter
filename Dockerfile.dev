# Dockerfile.dev
# Development environment for Rails, Go applications and truth layer operations
FROM debian:12

# Update package lists
RUN apt-get update --quiet --yes

# Install locales and set UTF-8
RUN apt-get install --quiet --yes locales
RUN sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && locale-gen
ENV LANG=en_US.UTF-8
ENV LANGUAGE=en_US:en
ENV LC_ALL=en_US.UTF-8

# Install build essentials and common tools
RUN apt-get install --quiet --yes \
    build-essential \
    curl \
    git \
    make \
    libpq-dev \
    libssl-dev \
    libreadline-dev \
    zlib1g-dev \
    libyaml-dev

# Install Ruby (for Rails and truth layer)
RUN apt-get install --quiet --yes ruby-full

# Install Node.js (for Rails asset pipeline)
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && \
    apt-get install --quiet --yes nodejs

# Install Yarn
RUN npm install -g yarn

# Install PostgreSQL client
RUN apt-get install --quiet --yes postgresql-client

# Install Rails and Bundler
RUN gem install bundler rails -N

# Install Go 1.22
RUN curl -fsSL https://go.dev/dl/go1.22.5.linux-amd64.tar.gz | tar -C /usr/local -xzf -
ENV PATH="/usr/local/go/bin:/root/go/bin:${PATH}"
ENV GOPATH="/root/go"

# Set working directory
WORKDIR /root/workspace

# Keep container running
CMD ["/bin/bash", "-c", "tail -f /dev/null"]
